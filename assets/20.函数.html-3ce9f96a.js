import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{o as n,c as a,f as p,a as e}from"./app-a89b456a.js";const o={},t=e(`<h2 id="函数" tabindex="-1"><a class="header-anchor" href="#函数" aria-hidden="true">#</a> 函数</h2><h3 id="字符串函数" tabindex="-1"><a class="header-anchor" href="#字符串函数" aria-hidden="true">#</a> 字符串函数</h3><table><thead><tr><th style="text-align:left;">函数</th><th style="text-align:left;">功能</th></tr></thead><tbody><tr><td style="text-align:left;">concat(s1, s2, …, sn)</td><td style="text-align:left;">字符串拼接，将s1, s2, …, sn拼接成一个字符串</td></tr><tr><td style="text-align:left;">lower(str)</td><td style="text-align:left;">将字符串全部转为小写</td></tr><tr><td style="text-align:left;">upper(str)</td><td style="text-align:left;">将字符串全部转为大写</td></tr><tr><td style="text-align:left;">lpad(str, n, pad)</td><td style="text-align:left;">左填充，用字符串pad对str的左边进行填充，达到n个字符串长度</td></tr><tr><td style="text-align:left;">rpad(str, n, pad)</td><td style="text-align:left;">右填充，用字符串pad对str的右边进行填充，达到n个字符串长度</td></tr><tr><td style="text-align:left;">trim(str)</td><td style="text-align:left;">去掉字符串头部和尾部的空格</td></tr><tr><td style="text-align:left;">substring(str,pos,len)</td><td style="text-align:left;">从str的pos位置开始，返回长度为len的子字符串</td></tr><tr><td style="text-align:left;">ascii(str)</td><td style="text-align:left;">返回字符串str的第一个字符的ASCII值。如果是空字符串，则返回0。          如果是null，则返回null。</td></tr><tr><td style="text-align:left;">char(a,b,c,&#39;d&#39;)</td><td style="text-align:left;">将参数解释为字符的ASCII码值，并返回由这些字符组成的一个字符串。       null值会被跳过。</td></tr><tr><td style="text-align:left;">character_length(str)</td><td style="text-align:left;">返回字符串str 的长度，对应多字节字符，长度记为1。</td></tr><tr><td style="text-align:left;">position(substr,str)</td><td style="text-align:left;">返回子串substr在字符串str中第一次出现的位置，索引从1开始。 如果substr不是在str里面，则返回0</td></tr><tr><td style="text-align:left;">locate(substr,str,pos)</td><td style="text-align:left;">返回子串substr在字符串str第一个出现的位置，从位置pos开始。 如果substr不是在str里面，则返回0。</td></tr><tr><td style="text-align:left;">left(str,len)</td><td style="text-align:left;">返回字符串str的最左面len个字符。</td></tr><tr><td style="text-align:left;">right(str,len)</td><td style="text-align:left;">返回字符串<code>str</code>的最右面<code>len</code>个字符。</td></tr><tr><td style="text-align:left;">replace(field_name,string1,string2)</td><td style="text-align:left;">将列中的string1字符串替换为string2</td></tr></tbody></table><p>例：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">1.</span>lpad<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
   企业员工的工号，统一为<span class="token number">5</span>位数，目前不足<span class="token number">5</span>位数的全部在前面补<span class="token number">0</span>。比如，<span class="token number">1</span>号员工的工号应该为<span class="token number">00001.</span>

   <span class="token keyword">update</span> emp <span class="token keyword">set</span> workno <span class="token operator">=</span> lpad<span class="token punctuation">(</span>workno<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token number">2.</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">select</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">,</span><span class="token number">121</span><span class="token punctuation">,</span><span class="token number">83</span><span class="token punctuation">,</span><span class="token number">81</span><span class="token punctuation">,</span><span class="token string">&#39;76&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">-- 输出为&#39;MySQL&#39;</span>
  
  <span class="token keyword">select</span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">,</span><span class="token number">77.3</span><span class="token punctuation">,</span><span class="token string">&#39;77.3&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">-- 输出&#39;MMM&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="数值函数" tabindex="-1"><a class="header-anchor" href="#数值函数" aria-hidden="true">#</a> 数值函数</h3><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>ceil(x)</td><td>向上取整</td></tr><tr><td>floor(x)</td><td>向下取整</td></tr><tr><td>mod(x,y)</td><td>返回x/y的模</td></tr><tr><td>rand( )</td><td>返回0~1内的随机数</td></tr><tr><td>round(x,y)</td><td>求参数x的四舍五入的值，保留y位小数</td></tr><tr><td>bin(n)</td><td>返回n的二进制值(使用字符串表示)，n是一个长整数(bigint)数字。如果n是null，则返回null</td></tr><tr><td>oct(n)</td><td>返回n的八进制值(使用字符串表示)，n是一个长整数(bigint)数字。如果n是null，则返回null</td></tr><tr><td>hex(n)</td><td>返回n的十六进制值，n是一个长整数(bigint)数字。如果n是null，则返回null</td></tr></tbody></table><h3 id="日期函数" tabindex="-1"><a class="header-anchor" href="#日期函数" aria-hidden="true">#</a> 日期函数</h3><table><thead><tr><th style="text-align:left;">函数</th><th style="text-align:left;">功能</th></tr></thead><tbody><tr><td style="text-align:left;">curdate( )</td><td style="text-align:left;">返回当前日期</td></tr><tr><td style="text-align:left;">curtime( )</td><td style="text-align:left;">返回当前时间</td></tr><tr><td style="text-align:left;">now( )</td><td style="text-align:left;">返回当前日期和时间</td></tr><tr><td style="text-align:left;">year(date)</td><td style="text-align:left;">获取指定date的年份</td></tr><tr><td style="text-align:left;">month(date)</td><td style="text-align:left;">获取指定date的月份</td></tr><tr><td style="text-align:left;">day(date)</td><td style="text-align:left;">获取指定date的日期</td></tr><tr><td style="text-align:left;">date_add(date, interval expr type)</td><td style="text-align:left;">返回一个日期/时间值加上一个时间间隔expr后的时间值</td></tr><tr><td style="text-align:left;">datediff (date1, date2)</td><td style="text-align:left;">返回起始时间date1和结束时间date2之间的天数</td></tr></tbody></table><p>例：</p><p>1.date_add：增加指定的时间间隔</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> date_add<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">interval</span> <span class="token number">70</span> <span class="token keyword">YEAR</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">#返回现在的时间加上70年后的时间</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>​ 2.datediff：获取两个日期相差的天数</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> datediff<span class="token punctuation">(</span><span class="token string">&#39;2021-10-01&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2021-12-01&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>​ 3.查询所有员工的入职天数，并根据入职天数倒序排序。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> name<span class="token punctuation">,</span> datediff<span class="token punctuation">(</span>curdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entrydate<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;entrydays&#39;</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span>  entrydays <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="流程函数" tabindex="-1"><a class="header-anchor" href="#流程函数" aria-hidden="true">#</a> 流程函数</h3><table><thead><tr><th style="text-align:left;">函数</th><th style="text-align:left;">功能</th></tr></thead><tbody><tr><td style="text-align:left;">if(expr, t, f)</td><td style="text-align:left;">如果expr为true，则返回t，否则返回f</td></tr><tr><td style="text-align:left;">ifnull(value1, value2)</td><td style="text-align:left;">如果value1不为空，返回value1，否则返回value2</td></tr><tr><td style="text-align:left;">nullif(value1,value2)</td><td style="text-align:left;">如果value1等于value2，返回null；否则返回value1 <strong>value可以是数字、字符串或表达式</strong></td></tr><tr><td style="text-align:left;">case when [ expr] then [ res1 ] … else [ default ] end</td><td style="text-align:left;">如果expr为true，返回res1，… 否则返回default默认值</td></tr><tr><td style="text-align:left;">case [ expr ] when [ val1 ] then [ res1 ] … else [ default ] end</td><td style="text-align:left;">如果expr的值等于val1，返回res1，… 否则返回default默认值</td></tr></tbody></table><p>注意：</p><p>​ 1.在case when语句中，如果有多种情况，就用多个when...then... ，且多个when之间是if elseif 的关系，</p><p>    即，只有一个when...then...语句能够执行， 如果所有的情况都不符合，则执行else。不能丢了end。</p><p>​ 2.nullif()函数与以下使用case的表达式类似：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">case</span> <span class="token keyword">when</span> value1 <span class="token operator">=</span> value2

   <span class="token keyword">then</span> <span class="token boolean">null</span>
   
<span class="token keyword">else</span>

   value1
   
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>例：</p><p>​ 查询emp表的员工姓名和工作地址 (北京/上海 ----&gt; 一线城市 , 其他 ----&gt; 二线城市)</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span>

 name<span class="token punctuation">,</span>
 
 <span class="token punctuation">(</span> <span class="token keyword">case</span> workaddress <span class="token keyword">when</span> <span class="token string">&#39;北京&#39;</span> <span class="token keyword">then</span> <span class="token string">&#39;一线城市&#39;</span> <span class="token keyword">when</span> <span class="token string">&#39;上海&#39;</span> <span class="token keyword">then</span> <span class="token string">&#39;一线城市&#39;</span> <span class="token keyword">else</span>
  
	<span class="token string">&#39;二线城市&#39;</span> <span class="token keyword">end</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;工作地址&#39;</span>  <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="窗口函数" tabindex="-1"><a class="header-anchor" href="#窗口函数" aria-hidden="true">#</a> 窗口函数</h2><h3 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h3><p>窗口函数又名开窗函数，属于分析函数的一种。用于解决复杂报表统计需求的功能强大的函数。</p><p>窗口函数的作用类似于在查询中对数据进行分组，不同的是，分组操作会把分组的结果聚合成一条记录，而窗口函数是将结果置于每一条数据记录中。</p><p>窗口函数可以分为静态窗口函数和动态窗口函数。</p><ul><li><p>静态窗口函数的窗口大小是固定的，不会因为记录的不同而不同，且<strong>不能使用frame子句</strong>；</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>rank（）、dense_rank<span class="token punctuation">(</span><span class="token punctuation">)</span>、row_number<span class="token punctuation">(</span><span class="token punctuation">)</span>；
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>动态窗口函数的窗口大小会随着记录的不同而变化。</p></li></ul><p>窗口函数总体上可以分为序号函数、分布函数、前后函数、首尾函数和其他函数。</p><h3 id="语法" tabindex="-1"><a class="header-anchor" href="#语法" aria-hidden="true">#</a> 语法</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>函数名 <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">partition</span> <span class="token keyword">by</span> 字段名 <span class="token keyword">order</span> <span class="token keyword">by</span> 字段名 <span class="token keyword">asc</span><span class="token operator">|</span><span class="token keyword">desc</span> frame_clause<span class="token punctuation">]</span><span class="token punctuation">)</span>

或

函数 <span class="token keyword">over</span> 窗口名 … window 窗口名 <span class="token keyword">as</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">partition</span> <span class="token keyword">by</span> 字段名 <span class="token keyword">order</span> <span class="token keyword">by</span> 字段名 <span class="token keyword">asc</span><span class="token operator">|</span><span class="token keyword">desc</span> frame_clause<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">over</span>关键字:
  指定函数窗口的范围。
  如果省略后面括号中的内容，则窗口会包含满足<span class="token keyword">where</span>条件的所有记录，窗口函数会基于所有满足<span class="token keyword">WHERE</span>条件的记录进行计算。
  如果<span class="token keyword">over</span>关键字后面的括号不为空，则可以使用如下语法设置窗口：           
    <span class="token keyword">partition</span> <span class="token keyword">by</span> 子句：指定记录按照哪些字段进行分组。分组后，窗口函数可以在每个分组中分别执行。
    <span class="token keyword">order</span> <span class="token keyword">by</span>子句：指定记录按照哪些字段进行排序。执行排序操作使窗口函数按照排序后的数据记录的顺序进行编号。

frame子句：
   frame_units  frame_extent      指定记录分组后，窗口函数作用的范围。
   
window 窗口名：为窗口设置一个别名，用来标识窗口。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="frame子句详解" tabindex="-1"><a class="header-anchor" href="#frame子句详解" aria-hidden="true">#</a> frame子句详解</h3><p>[frame_clause]是可选参数，如果没有写出，则会设置为默认框架范围，<strong>默认框架范围取决于是否进行了排序或分类。</strong></p><p>1.如果未进行排序或分类(sum1)，则默认范围为所有行。</p><p>2.使用 order by 进行排序，<strong>但未进行分类</strong>(sum2)，则默认范围为第一行到当前行。</p><p>3.使用 partition by 进行分类(sum)，则默认范围为每个分区的所有行。</p><p>例：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 数据表store</span>
<span class="token operator">+</span><span class="token comment">----------+---------+----------+</span>
<span class="token operator">|</span> order_id <span class="token operator">|</span> product <span class="token operator">|</span> quantity <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+---------+----------+</span>
<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">12</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+---------+----------+</span>

<span class="token number">1.</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sum1 <span class="token keyword">from</span> store<span class="token punctuation">;</span>  <span class="token comment">-- 没有分类，没有排序</span>
   
    <span class="token operator">+</span><span class="token comment">----------+---------+----------+------+</span>
    <span class="token operator">|</span> order_id <span class="token operator">|</span> product <span class="token operator">|</span> quantity <span class="token operator">|</span> sum1 <span class="token operator">|</span>
	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+</span>
	<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">61</span> <span class="token operator">|</span>  	   <span class="token comment">-- 范围为所有行，得到同一个结果</span>
	<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">61</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">61</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">61</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">61</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">61</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">12</span> <span class="token operator">|</span>   <span class="token number">61</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span>   <span class="token number">61</span> <span class="token operator">|</span>
	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+</span>
	
<span class="token number">2.</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> product<span class="token punctuation">)</span> <span class="token keyword">as</span> sum2 
 
         <span class="token function">sum</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> product<span class="token punctuation">)</span> <span class="token keyword">as</span> sum3
         
         <span class="token keyword">from</span> store<span class="token punctuation">;</span>
         
    <span class="token operator">+</span><span class="token comment">----------+---------+----------+------+------+</span>
	<span class="token operator">|</span> order_id <span class="token operator">|</span> product <span class="token operator">|</span> quantity <span class="token operator">|</span> sum2  <span class="token operator">|</span> sum3 <span class="token operator">|</span>
	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+------+</span>
	<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">25</span> <span class="token operator">|</span>   <span class="token number">25</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">25</span> <span class="token operator">|</span>   <span class="token number">25</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">25</span> <span class="token operator">|</span>   <span class="token number">25</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">53</span> <span class="token operator">|</span>   <span class="token number">28</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">12</span> <span class="token operator">|</span>   <span class="token number">53</span> <span class="token operator">|</span>   <span class="token number">28</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span>   <span class="token number">53</span> <span class="token operator">|</span>   <span class="token number">28</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">61</span> <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">61</span> <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>
	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+------+</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>框架基本单位(frame_units)</p><p>框架的计数单位分为两种：{rows | range}，默认值为range</p><p>    rows：框架由开始行和结束行的位置来定义；</p><p>    range(有排序)：以连续相同的值为一个单位</p><p>    range(无排序)：以分区为单位</p><p>例：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> 

    <span class="token operator">*</span><span class="token punctuation">,</span>
    	
    <span class="token function">sum</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> product <span class="token keyword">order</span> <span class="token keyword">by</span> quantity <span class="token keyword">rows</span> <span class="token keyword">current</span> <span class="token keyword">row</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sum1<span class="token punctuation">,</span>
    
    <span class="token function">sum</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> product <span class="token keyword">order</span> <span class="token keyword">by</span> quantity range <span class="token keyword">current</span> <span class="token keyword">row</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sum2<span class="token punctuation">,</span>
    
    <span class="token function">sum</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> product range <span class="token keyword">current</span> <span class="token keyword">row</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sum3
    
<span class="token keyword">from</span> store<span class="token punctuation">;</span>

	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+------+------+</span>
	<span class="token operator">|</span> order_id <span class="token operator">|</span> product <span class="token operator">|</span> quantity <span class="token operator">|</span> sum1 <span class="token operator">|</span> sum2 <span class="token operator">|</span> sum3 <span class="token operator">|</span>
	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+------+------+</span>
	<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">25</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>   <span class="token number">25</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>   <span class="token number">25</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span>   <span class="token number">28</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">28</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">12</span> <span class="token operator">|</span>   <span class="token number">12</span> <span class="token operator">|</span>   <span class="token number">12</span> <span class="token operator">|</span>   <span class="token number">28</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>
	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+------+------+</span>
	
<span class="token comment">-- sum1中，使用rows作为基本单位，所以对每一行进行单独计算</span>

<span class="token comment">-- sum2中，使用range作为基本单位，apple的第二、第三个订单数量都为10，所以第二、第三行视为一个单位</span>

<span class="token comment">-- sum3中，使用range作为基本单位，并且没有order by，所以每个分区为一个单位</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>框架范围(frame_extent)</p><p>框架语句分为以下几种：</p><ul><li>current row -------------- 当前行</li><li>unbounded preceding ---当前行上侧所有行</li><li>unbounded following ----当前行下侧所有行</li><li>expr preceding -----------当前行上侧expr行(expr可以是数字，也可以是表达式)</li><li>expr following ------------当前行下侧expr行(expr可以是数字，也可以是表达式)</li></ul><p>框架范围可由两种形式来定义：{frame_start | frame_between}，范围的定义基于基本单位。</p><p>frame_start：仅指定开始行(或区域)，则结束范围为默认值，即<strong>当前行(或区域)</strong></p><p>例：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span>

    <span class="token operator">*</span><span class="token punctuation">,</span>
    
    <span class="token function">sum</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> product <span class="token keyword">order</span> <span class="token keyword">by</span> quantity <span class="token keyword">rows</span> <span class="token number">1</span> <span class="token keyword">preceding</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sum
    
<span class="token keyword">from</span> store<span class="token punctuation">;</span>

	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+</span>
	<span class="token operator">|</span> order_id <span class="token operator">|</span> product <span class="token operator">|</span> quantity <span class="token operator">|</span> sum  <span class="token operator">|</span>
	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+</span>
	<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">15</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">16</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">12</span> <span class="token operator">|</span>   <span class="token number">22</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>
	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+</span>
	
<span class="token comment">-- 语句仅设置了frame_start部分(rows 1 preceding)，即当前行的前一行，而结束行则默认为当前行，</span>

<span class="token comment">-- 所以sum的结果是相邻两行求和。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>frame_between：指定开始行(或区域)与结束行(或区域)</p><p>  frame_between语句：between frame_start and frame_end</p><p>例：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> 

    <span class="token operator">*</span><span class="token punctuation">,</span>
        
    <span class="token function">SUM</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> product <span class="token keyword">order</span> <span class="token keyword">by</span> quantity <span class="token keyword">rows</span> <span class="token operator">between</span> <span class="token keyword">unbounded</span> <span class="token keyword">preceding</span> 
                        
     <span class="token operator">and</span>
                        
     <span class="token keyword">current</span> <span class="token keyword">row</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sum
     
<span class="token keyword">from</span> store<span class="token punctuation">;</span>

    <span class="token operator">+</span><span class="token comment">----------+---------+----------+------+</span>
	<span class="token operator">|</span> order_id <span class="token operator">|</span> product <span class="token operator">|</span> quantity <span class="token operator">|</span> sum  <span class="token operator">|</span>
	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+</span>
	<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">15</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span> apple   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">25</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>   <span class="token number">16</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span> bread   <span class="token operator">|</span>       <span class="token number">12</span> <span class="token operator">|</span>   <span class="token number">28</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>
	<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> cereal  <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>
	<span class="token operator">+</span><span class="token comment">----------+---------+----------+------+</span>
	
<span class="token comment">-- 框架范围为第一行至当前行，实现了累计求和的效果。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="分类" tabindex="-1"><a class="header-anchor" href="#分类" aria-hidden="true">#</a> 分类</h3><p><strong>序号函数：</strong></p><p>1.row_number( ) 对处理后的数据进行顺序编号</p><p>2.rank( ) 并列排序，会跳过重复的序号，比如1、1、3(并列第一，没有第二名)</p><p>3.dense_rank( ) 并列排序，不会跳过重复的序号，比如序号为1、1、2(并列第一，但依然有第二名)</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 数据表goods</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> goods<span class="token punctuation">(</span>category_id<span class="token punctuation">,</span>category<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>price<span class="token punctuation">,</span>stock<span class="token punctuation">,</span>upper_time<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;女装/女士精品&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;T恤&#39;</span><span class="token punctuation">,</span> <span class="token number">39.90</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;女装/女士精品&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;连衣裙&#39;</span><span class="token punctuation">,</span> <span class="token number">79.90</span><span class="token punctuation">,</span> <span class="token number">2500</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;女装/女士精品&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;卫衣&#39;</span><span class="token punctuation">,</span> <span class="token number">89.90</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;女装/女士精品&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;牛仔裤&#39;</span><span class="token punctuation">,</span> <span class="token number">89.90</span><span class="token punctuation">,</span> <span class="token number">3500</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;女装/女士精品&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;百褶裙&#39;</span><span class="token punctuation">,</span> <span class="token number">29.90</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;女装/女士精品&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;呢绒外套&#39;</span><span class="token punctuation">,</span> <span class="token number">399.90</span><span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;户外运动&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;自行车&#39;</span><span class="token punctuation">,</span> <span class="token number">399.90</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;户外运动&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;山地自行车&#39;</span><span class="token punctuation">,</span> <span class="token number">1399.90</span><span class="token punctuation">,</span> <span class="token number">2500</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;户外运动&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;登山杖&#39;</span><span class="token punctuation">,</span> <span class="token number">59.90</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;户外运动&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;骑行装备&#39;</span><span class="token punctuation">,</span> <span class="token number">399.90</span><span class="token punctuation">,</span> <span class="token number">3500</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;户外运动&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;运动外套&#39;</span><span class="token punctuation">,</span> <span class="token number">799.90</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;户外运动&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;滑板&#39;</span><span class="token punctuation">,</span> <span class="token number">499.90</span><span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">,</span> <span class="token string">&#39;2020-11-10 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token number">1.</span>查询 goods 数据表中每个商品分类下价格最高的<span class="token number">3</span>种商品信息。

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span>

    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span>
        
    <span class="token operator">-</span><span class="token operator">&gt;</span>  <span class="token keyword">SELECT</span> ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> row_num<span class="token punctuation">,</span>
        
    <span class="token operator">-</span><span class="token operator">&gt;</span>  id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock
        
    <span class="token operator">-</span><span class="token operator">&gt;</span>  <span class="token keyword">FROM</span> goods<span class="token punctuation">)</span> t
    
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">WHERE</span> row_num <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+----+-------------+---------------+------------+---------+-------+</span>
<span class="token operator">|</span> row_num <span class="token operator">|</span> id <span class="token operator">|</span> category_id <span class="token operator">|</span> category      <span class="token operator">|</span> NAME       <span class="token operator">|</span> price   <span class="token operator">|</span> stock <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----+-------------+---------------+------------+---------+-------+</span>
<span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 呢绒外套    <span class="token operator">|</span>  <span class="token number">399.90</span>  <span class="token operator">|</span>  <span class="token number">1200</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">2</span> <span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 卫衣        <span class="token operator">|</span>   <span class="token number">89.90</span> <span class="token operator">|</span>  <span class="token number">1500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 牛仔裤      <span class="token operator">|</span>   <span class="token number">89.90</span>  <span class="token operator">|</span>  <span class="token number">3500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 山地自行车   <span class="token operator">|</span> <span class="token number">1399.90</span>  <span class="token operator">|</span>  <span class="token number">2500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 运动外套     <span class="token operator">|</span>  <span class="token number">799.90</span>  <span class="token operator">|</span>   <span class="token number">500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 滑板        <span class="token operator">|</span>  <span class="token number">499.90</span>  <span class="token operator">|</span>  <span class="token number">1200</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----+-------------+---------------+------------+----------+-------+</span>


<span class="token number">2.</span>使用RANK<span class="token punctuation">(</span><span class="token punctuation">)</span>函数获取 goods 数据表中各类别的价格从高到低排序的各商品信息

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> row_num<span class="token punctuation">,</span>

    <span class="token operator">-</span><span class="token operator">&gt;</span> id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock
                                                                                                       <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">FROM</span> goods<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+----+-------------+---------------+------------+---------+-------+</span>
<span class="token operator">|</span> row_num <span class="token operator">|</span> id <span class="token operator">|</span> category_id <span class="token operator">|</span> category      <span class="token operator">|</span> NAME       <span class="token operator">|</span> price   <span class="token operator">|</span> stock <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----+-------------+---------------+------------+---------+-------+</span>
<span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 呢绒外套    <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>  <span class="token number">1200</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">2</span> <span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 卫衣        <span class="token operator">|</span>   <span class="token number">89.90</span> <span class="token operator">|</span>  <span class="token number">1500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">2</span> <span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 牛仔裤      <span class="token operator">|</span>   <span class="token number">89.90</span> <span class="token operator">|</span>  <span class="token number">3500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 连衣裙      <span class="token operator">|</span>   <span class="token number">79.90</span> <span class="token operator">|</span>  <span class="token number">2500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> T恤         <span class="token operator">|</span>   <span class="token number">39.90</span> <span class="token operator">|</span>  <span class="token number">1000</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">6</span> <span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 百褶裙      <span class="token operator">|</span>   <span class="token number">29.90</span> <span class="token operator">|</span>   <span class="token number">500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 山地自行车   <span class="token operator">|</span> <span class="token number">1399.90</span> <span class="token operator">|</span>  <span class="token number">2500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 运动外套     <span class="token operator">|</span>  <span class="token number">799.90</span> <span class="token operator">|</span>   <span class="token number">500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 滑板        <span class="token operator">|</span>  <span class="token number">499.90</span> <span class="token operator">|</span>  <span class="token number">1200</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 自行车      <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>  <span class="token number">1000</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 骑行装备    <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>  <span class="token number">3500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">6</span> <span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 登山杖      <span class="token operator">|</span>   <span class="token number">59.90</span> <span class="token operator">|</span>  <span class="token number">1500</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----+-------------+---------------+------------+---------+-------+</span>


<span class="token number">3.</span>使用DENSE_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span>函数获取 goods 数据表中类别为“女装<span class="token operator">/</span>女士精品”的价格最高的<span class="token number">4</span>款商品信息

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span>

    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">FROM</span><span class="token punctuation">(</span>
        
    <span class="token operator">-</span><span class="token operator">&gt;</span>  <span class="token keyword">SELECT</span> DENSE_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> row_num<span class="token punctuation">,</span>
        
    <span class="token operator">-</span><span class="token operator">&gt;</span>  id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock
        
    <span class="token operator">-</span><span class="token operator">&gt;</span>  <span class="token keyword">FROM</span> goods<span class="token punctuation">)</span> t
    
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">WHERE</span> category_id <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> row_num <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+----+-------------+---------------+----------+--------+-------+</span>
<span class="token operator">|</span> row_num <span class="token operator">|</span> id <span class="token operator">|</span> category_id <span class="token operator">|</span> category      <span class="token operator">|</span> NAME     <span class="token operator">|</span> price  <span class="token operator">|</span> stock <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----+-------------+---------------+----------+--------+-------+</span>
<span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 呢绒外套  <span class="token operator">|</span> <span class="token number">399.90</span> <span class="token operator">|</span>  <span class="token number">1200</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">2</span> <span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 卫衣     <span class="token operator">|</span>  <span class="token number">89.90</span>  <span class="token operator">|</span>  <span class="token number">1500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">2</span> <span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 牛仔裤    <span class="token operator">|</span>  <span class="token number">89.90</span> <span class="token operator">|</span>  <span class="token number">3500</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 连衣裙    <span class="token operator">|</span>  <span class="token number">79.90</span> <span class="token operator">|</span>  <span class="token number">2500</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----+-------------+---------------+----------+--------+-------+</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>分布函数：</strong></p><p>percent_rank( )</p><p>  等级值百分比 (rank - 1) / (rows - 1) rank的值为使用RANK()函数产生的序号，rows的值为当前窗口的总记录数</p><p>cume_dist( ) 累计分布值</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">1.</span>计算 goods 数据表中名称为“女装<span class="token operator">/</span>女士精品”的类别下的商品的PERCENT_RANK值。

<span class="token comment">#写法一：</span>
<span class="token keyword">SELECT</span> RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> r<span class="token punctuation">,</span>
PERCENT_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pr<span class="token punctuation">,</span>
id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock
<span class="token keyword">FROM</span> goods
<span class="token keyword">WHERE</span> category_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#写法二：</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> r<span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> PERCENT_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> pr<span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">FROM</span> goods
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">WHERE</span> category_id <span class="token operator">=</span> <span class="token number">1</span> WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---+-----+----+-------------+---------------+----------+--------+-------+</span>
<span class="token operator">|</span> r <span class="token operator">|</span> pr  <span class="token operator">|</span> id <span class="token operator">|</span> category_id <span class="token operator">|</span> category      <span class="token operator">|</span> NAME     <span class="token operator">|</span> price  <span class="token operator">|</span> stock <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+-----+----+-------------+---------------+----------+--------+-------+</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 呢绒外套  <span class="token operator">|</span> <span class="token number">399.90</span> <span class="token operator">|</span>  <span class="token number">1200</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">0.2</span> <span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 卫衣     <span class="token operator">|</span>  <span class="token number">89.90</span> <span class="token operator">|</span>  <span class="token number">1500</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">0.2</span> <span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 牛仔裤   <span class="token operator">|</span>  <span class="token number">89.90</span> <span class="token operator">|</span>  <span class="token number">3500</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">0.6</span> <span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 连衣裙   <span class="token operator">|</span>  <span class="token number">79.90</span> <span class="token operator">|</span>  <span class="token number">2500</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">5</span> <span class="token operator">|</span> <span class="token number">0.8</span> <span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> T恤      <span class="token operator">|</span>  <span class="token number">39.90</span> <span class="token operator">|</span>  <span class="token number">1000</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">6</span> <span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 百褶裙   <span class="token operator">|</span>  <span class="token number">29.90</span>  <span class="token operator">|</span>   <span class="token number">500</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+-----+----+-------------+---------------+----------+--------+-------+</span>


<span class="token number">2.</span>查询goods数据表中小于或等于当前价格的比例。

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> CUME_DIST<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">ASC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> cd<span class="token punctuation">,</span>

    <span class="token operator">-</span><span class="token operator">&gt;</span> id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price
    
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">FROM</span> goods<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+----+---------------+------------+---------+</span>
<span class="token operator">|</span> cd                  <span class="token operator">|</span> id <span class="token operator">|</span> category      <span class="token operator">|</span> NAME       <span class="token operator">|</span> price   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+----+---------------+------------+---------+</span>
<span class="token operator">|</span> <span class="token number">0.16666666666666666</span> <span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 百褶裙      <span class="token operator">|</span>   <span class="token number">29.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">0.3333333333333333</span> <span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> T恤        <span class="token operator">|</span>   <span class="token number">39.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>                 <span class="token number">0.5</span> <span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 连衣裙      <span class="token operator">|</span>   <span class="token number">79.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">0.8333333333333334</span> <span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 卫衣        <span class="token operator">|</span>   <span class="token number">89.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">0.8333333333333334</span> <span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 牛仔裤      <span class="token operator">|</span>   <span class="token number">89.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>                   <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 呢绒外套    <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">0.16666666666666666</span> <span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 登山杖      <span class="token operator">|</span>   <span class="token number">59.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>                 <span class="token number">0.5</span> <span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 自行车      <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>                 <span class="token number">0.5</span> <span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 骑行装备     <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">0.6666666666666666</span> <span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 滑板        <span class="token operator">|</span>  <span class="token number">499.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">0.8333333333333334</span> <span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 运动外套    <span class="token operator">|</span>  <span class="token number">799.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>                   <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 山地自行车   <span class="token operator">|</span> <span class="token number">1399.90</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+----+---------------+------------+---------+</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>前后函数：</strong></p><p>lag(expr,offset,default) 返回当前行的前面第n行的expr的值</p><p>lead(expr,offset,default) 返回当前行的后面第n行的expr的值</p><p>   expr 通常是直接是列名，也可以是从其他行返回的表达式；</p><p>   offset 默认为1，表示在当前分区内基于当前行的偏移行数；</p><p>   default 是在offset指定的偏移行数超出了分组的范围时的返回值，否则会返回null。</p><p>如果只指定一个常量，如，lag(2)，则将该值直接作为结果返回(偏移行数默认为1)，</p><p>   但对于lag函数，分区内第一行仍然为null，同理，对于lag函数，分区内最后一行仍然为null。</p><p>如果指定2个常量，也是将该值直接作为结果返回(第一个参数为偏移行数)，这样分区内最后两行仍然为null。</p><p>   同理，lag时分区内前两行也是null)。</p><p>如果是3个参数都是常量，则会把最后一个常量当作默认值替代null。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">1.</span>查询goods数据表中前一个商品价格与当前商品价格的差值

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> pre_price<span class="token punctuation">,</span> price <span class="token operator">-</span> pre_price <span class="token keyword">AS</span> diff_price

    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span>
        
    <span class="token operator">-</span><span class="token operator">&gt;</span>  <span class="token keyword">SELECT</span>  id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span>LAG<span class="token punctuation">(</span>price<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> pre_price
        
    <span class="token operator">-</span><span class="token operator">&gt;</span>  <span class="token keyword">FROM</span> goods
        
    <span class="token operator">-</span><span class="token operator">&gt;</span>  WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token punctuation">)</span><span class="token punctuation">)</span> t<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+---------------+------------+---------+-----------+------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> category      <span class="token operator">|</span> NAME       <span class="token operator">|</span> price   <span class="token operator">|</span> pre_price <span class="token operator">|</span> diff_price <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+---------------+------------+---------+-----------+------------+</span>
<span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 百褶裙      <span class="token operator">|</span>   <span class="token number">29.90</span> <span class="token operator">|</span>      <span class="token boolean">NULL</span> <span class="token operator">|</span>       <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> T恤        <span class="token operator">|</span>   <span class="token number">39.90</span> <span class="token operator">|</span>     <span class="token number">29.90</span> <span class="token operator">|</span>      <span class="token number">10.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 连衣裙      <span class="token operator">|</span>   <span class="token number">79.90</span> <span class="token operator">|</span>     <span class="token number">39.90</span> <span class="token operator">|</span>      <span class="token number">40.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 卫衣       <span class="token operator">|</span>   <span class="token number">89.90</span> <span class="token operator">|</span>     <span class="token number">79.90</span> <span class="token operator">|</span>      <span class="token number">10.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 牛仔裤      <span class="token operator">|</span>   <span class="token number">89.90</span> <span class="token operator">|</span>     <span class="token number">89.90</span> <span class="token operator">|</span>       <span class="token number">0.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 呢绒外套    <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>     <span class="token number">89.90</span> <span class="token operator">|</span>     <span class="token number">310.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 登山杖      <span class="token operator">|</span>   <span class="token number">59.90</span> <span class="token operator">|</span>      <span class="token boolean">NULL</span> <span class="token operator">|</span>       <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 自行车      <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>     <span class="token number">59.90</span> <span class="token operator">|</span>     <span class="token number">340.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 骑行装备    <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>    <span class="token number">399.90</span> <span class="token operator">|</span>       <span class="token number">0.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 滑板       <span class="token operator">|</span>  <span class="token number">499.90</span> <span class="token operator">|</span>    <span class="token number">399.90</span> <span class="token operator">|</span>     <span class="token number">100.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 运动外套    <span class="token operator">|</span>  <span class="token number">799.90</span> <span class="token operator">|</span>    <span class="token number">499.90</span> <span class="token operator">|</span>     <span class="token number">300.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 山地自行车  <span class="token operator">|</span> <span class="token number">1399.90</span> <span class="token operator">|</span>    <span class="token number">799.90</span> <span class="token operator">|</span>     <span class="token number">600.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+---------------+------------+---------+-----------+------------+</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>首尾函数：</strong></p><p>first_value(expr) 返回第一个expr的值</p><p>last_value(expr) 返回最后一个expr的值</p><p>  可以接收一个常量参数，效果等同于直接将该值作为结果返回。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">1.</span>按照价格排序，查询最后一个商品的价格信息。

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock<span class="token punctuation">,</span>LAST_VALUE<span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> last_price

    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">FROM</span> goods WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token operator">+</span><span class="token comment">----+---------------+------------+---------+-------+------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> category      <span class="token operator">|</span> NAME       <span class="token operator">|</span> price   <span class="token operator">|</span> stock <span class="token operator">|</span> last_price <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+---------------+------------+---------+-------+------------+</span>
<span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 百褶裙     <span class="token operator">|</span>   <span class="token number">29.90</span> <span class="token operator">|</span>   <span class="token number">500</span> <span class="token operator">|</span>      <span class="token number">29.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> T恤        <span class="token operator">|</span>   <span class="token number">39.90</span> <span class="token operator">|</span>  <span class="token number">1000</span> <span class="token operator">|</span>      <span class="token number">39.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 连衣裙     <span class="token operator">|</span>   <span class="token number">79.90</span> <span class="token operator">|</span>  <span class="token number">2500</span> <span class="token operator">|</span>      <span class="token number">79.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 卫衣       <span class="token operator">|</span>   <span class="token number">89.90</span> <span class="token operator">|</span>  <span class="token number">1500</span> <span class="token operator">|</span>      <span class="token number">89.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 牛仔裤     <span class="token operator">|</span>   <span class="token number">89.90</span> <span class="token operator">|</span>  <span class="token number">3500</span> <span class="token operator">|</span>      <span class="token number">89.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品   <span class="token operator">|</span> 呢绒外套   <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>  <span class="token number">1200</span> <span class="token operator">|</span>     <span class="token number">399.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 登山杖     <span class="token operator">|</span>   <span class="token number">59.90</span> <span class="token operator">|</span>  <span class="token number">1500</span> <span class="token operator">|</span>      <span class="token number">59.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 自行车     <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>  <span class="token number">1000</span> <span class="token operator">|</span>     <span class="token number">399.90</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 骑行装备   <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>  <span class="token number">3500</span> <span class="token operator">|</span>     <span class="token number">399.90</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 滑板       <span class="token operator">|</span>  <span class="token number">499.90</span> <span class="token operator">|</span>  <span class="token number">1200</span> <span class="token operator">|</span>     <span class="token number">499.90</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 运动外套   <span class="token operator">|</span>  <span class="token number">799.90</span> <span class="token operator">|</span>   <span class="token number">500</span> <span class="token operator">|</span>     <span class="token number">799.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> 户外运动       <span class="token operator">|</span> 山地自行车 <span class="token operator">|</span> <span class="token number">1399.90</span> <span class="token operator">|</span>  <span class="token number">2500</span> <span class="token operator">|</span>    <span class="token number">1399.90</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+---------------+------------+---------+-------+------------+</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其他函数</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>nth_value<span class="token punctuation">(</span>expr<span class="token punctuation">,</span>n<span class="token punctuation">)</span>                    返回第n个expr的值

nfile<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">order</span> <span class="token keyword">by</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>     
   对一个数据分区中的有序结果集进行划分，将其分组到各个桶，并为每个小组分配一个唯一的组编号。
   n不能小于等于<span class="token number">0</span>，<span class="token keyword">over</span>中必须有<span class="token keyword">order</span> <span class="token keyword">by</span> 子句。

ratio_to_report<span class="token punctuation">(</span>expr<span class="token punctuation">)</span>  <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>    用来计算总数百分比，但不能跟<span class="token keyword">order</span> <span class="token keyword">by</span> 子句
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#将goods表中的商品按照价格分为3组。</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> NFILE<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> nt<span class="token punctuation">,</span>id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price

    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">FROM</span> goods WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+----+---------------+------------+---------+</span>
<span class="token operator">|</span> nt <span class="token operator">|</span> id <span class="token operator">|</span> category      <span class="token operator">|</span> NAME       <span class="token operator">|</span> price   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+----+---------------+------------+---------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品 <span class="token operator">|</span> 百褶裙     <span class="token operator">|</span>   <span class="token number">29.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品 <span class="token operator">|</span> T恤        <span class="token operator">|</span>   <span class="token number">39.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品 <span class="token operator">|</span> 连衣裙     <span class="token operator">|</span>   <span class="token number">79.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品 <span class="token operator">|</span> 卫衣       <span class="token operator">|</span>   <span class="token number">89.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品 <span class="token operator">|</span> 牛仔裤     <span class="token operator">|</span>   <span class="token number">89.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> 女装<span class="token operator">/</span>女士精品 <span class="token operator">|</span> 呢绒外套   <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> 户外运动      <span class="token operator">|</span> 登山杖     <span class="token operator">|</span>   <span class="token number">59.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> 户外运动      <span class="token operator">|</span> 自行车     <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">|</span> 户外运动      <span class="token operator">|</span> 骑行装备   <span class="token operator">|</span>  <span class="token number">399.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span> 户外运动      <span class="token operator">|</span> 滑板       <span class="token operator">|</span>  <span class="token number">499.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> 户外运动      <span class="token operator">|</span> 运动外套   <span class="token operator">|</span>  <span class="token number">799.90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> 户外运动      <span class="token operator">|</span> 山地自行车 <span class="token operator">|</span> <span class="token number">1399.90</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+----+---------------+------------+---------+</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：<strong>如果在over中已经添加了order by…，就不建议在from后面再添加相同的order by。</strong></p><h2 id="公用表表达式-cet" tabindex="-1"><a class="header-anchor" href="#公用表表达式-cet" aria-hidden="true">#</a> 公用表表达式(CET)</h2><p><strong>Common Table Expression</strong></p><p>   公用表表达式是在SQL查询中用于创建命名的临时结果集的结构。</p><p>   CTE提供了一种方便的方式来定义和引用复杂的子查询，使得查询更具可读性和可维护性。</p><p>   CTE可以在一个查询中多次引用，也可以使用递归方式定义。它由两部分组成：CTE名称和CTE定义。</p><p>   CTE定义部分是一个带有列表的SELECT语句，它定义了CTE的结构和筛选条件。</p><p>   <strong>CTE名称则用于在查询中引用这个临时结果集。</strong></p><p>   如果一个查询中<strong>多个子查询都需要使用同一个子查询</strong>的结果，就可以用with as 将共用的子查询提取出来，加个别名。</p><p>   后面的查询语句可以直接用，对于大量复杂的SQL语句起到了很好的优化作用。</p><p>   with as 短语，也叫做子查询部分（subquery factoring），用来定义一个SQL片断。</p><p>      该语句的作用是：在大量的报表查询时, 使用 with as 可以提取出大量的子查询, 更加简洁。</p><p>语法：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#定义一个</span>

 <span class="token keyword">with</span> CTE_Name <span class="token punctuation">(</span>Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>
    
   <span class="token keyword">select</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    
   <span class="token keyword">from</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    
   <span class="token keyword">where</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> CTE_Name <span class="token keyword">where</span> Column1 <span class="token operator">=</span> <span class="token string">&#39;Value&#39;</span>

<span class="token comment">#定义多个</span>

<span class="token keyword">with</span> subquery_name1 <span class="token keyword">as</span> <span class="token punctuation">(</span>subquery_body1<span class="token punctuation">)</span><span class="token punctuation">,</span>

     subquery_name2 <span class="token keyword">as</span> <span class="token punctuation">(</span>subquery_body2<span class="token punctuation">)</span>
        
     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> subquery_name1 a<span class="token punctuation">,</span> subquery_name2 b

	<span class="token keyword">where</span> a<span class="token punctuation">.</span>col <span class="token operator">=</span> b<span class="token punctuation">.</span>col

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：</p><ul><li>相当于一个临时表，但是不同于视图，不会存储起来，要与select配合使用。</li><li>同一个select前可以有多个临时表，写一个with就可以，用逗号隔开，最后一个with语句不要用逗号。</li><li>with子句要用括号括起来。</li></ul><p>定义CTE之后，我们可以将其用作select，insert，update和delete查询中的视图。</p>`,109);function r(l,c){return n(),a("div",null,[p("  permalink: /MySQL/基础语法/函数/ "),t])}const u=s(o,[["render",r],["__file","20.函数.html.vue"]]);export{u as default};
